!function(){"use strict";function e(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.textContent=t?o:r}const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};function r(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;const o=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),o.textContent="",o.classList.remove(r.errorClass)}const o=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},n=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},a=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):n(t,r)};let s,i;const c=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__name"),d=document.querySelector(".profile__description"),u=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addCard(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}toggleLikeCard(e,t){const r=t?"DELETE":"PUT";return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:r,headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"1f3d47ec-48a6-48e0-95f2-0844dd9a33b4","Content-Type":"application/json"}});u.getAppInfo().then((e=>{let[t,r]=e;t.forEach((function(e){G(K(e))})),c.src=r.avatar,l.textContent=r.name,d.textContent=r.about})).catch(console.error);const m=document.querySelector("#card__template").content,_=document.querySelector(".cards__list"),f=document.querySelector(".profile__column"),h=f.querySelector("#profile__name"),v=f.querySelector("#profile__description"),y=Array.from(document.querySelectorAll(".modal")),b=document.querySelector("#edit-profile-modal"),p=document.forms["modal__form-edit-profile"],S=b.querySelector("#name"),E=b.querySelector("#description"),q=document.querySelector("#profile__edit-btn"),k=document.querySelector("#modal__edit-profile-close-btn"),L=b.querySelector(".modal__button"),g=document.querySelector("#add-card-modal"),C=document.querySelector("#modal__add-card-close-btn"),$=document.forms["modal__form-add-card"],j=document.forms["edit-avatar-form"],U=document.forms["delete-form"],A=document.querySelector("#profile__add-card-btn"),P=document.querySelector(".profile__avatar-btn"),x=document.querySelector("#edit-avatar-modal"),D=document.querySelector("#delete-modal"),I=g.querySelector("#image-link-input"),w=g.querySelector("#caption-input"),T=g.querySelector(".modal__button"),B=j.querySelector("#profile-avatar-input"),N=U.querySelector(".modal__button-cancel"),O=document.querySelector(".modal__delete-close-btn"),J=document.querySelector("#modal-preview-image"),H=J.querySelector(".modal__preview-image"),z=J.querySelector(".modal__preview-image-title"),M=document.querySelector("#modal__preview-image-close-btn"),F=document.querySelector("#modal__edit-avatar-close-btn");function G(e){_[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend"](e)}function K(e){const t=m.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__image");r.addEventListener("click",(()=>{H.src=e.link,H.alt=e.name,z.textContent=e.name,R(J)})),r.src=e.link,r.alt=e.name,r.id=e._id;const o=t.querySelector(".card__content .card__title"),n=t.querySelector(".card__like-button");return e.isLiked&&n.classList.add("card__like-button-liked"),n.addEventListener("click",(t=>function(e,t){const r=e.target.classList.contains("card__like-button-liked");u.toggleLikeCard(t,r).then((()=>{e.target.classList.toggle("card__like-button-liked")})).catch(console.error)}(t,e._id))),t.querySelector(".card__delete-button").addEventListener("click",(()=>{!function(e,t){s=e,i=t}(t,e._id),R(D)})),o.textContent=e.name,t}const Q=e=>{"Escape"===e.key&&y.forEach((e=>{e.classList.contains("modal_opened")&&V(e)}))};function R(e){e.classList.add("modal_opened"),document.addEventListener("keydown",Q)}function V(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",Q)}q.addEventListener("click",(()=>{var e;S.value=h.textContent,E.value=v.textContent.trim(),e=p,[S,E].forEach((o=>{r(e,o,t)})),n(L,t),R(b)})),A.addEventListener("click",(()=>{R(g)})),k.addEventListener("click",(()=>{V(b)})),C.addEventListener("click",(()=>{V(g)})),P.addEventListener("click",(()=>{R(x)})),M.addEventListener("click",(()=>{V(J)})),F.addEventListener("click",(()=>{V(x)})),N.addEventListener("click",(()=>{V(D)})),O.addEventListener("click",(()=>{V(D)})),p.addEventListener("submit",(function(t){t.preventDefault(),e(t.submitter,!0),u.editUserInfo({name:S.value,about:E.value}).then((e=>{h.textContent=e.name,v.textContent=e.about,V(b)})).catch(console.error).finally((()=>{e(t.submitter,!1)}))})),$.addEventListener("submit",(function(r){r.preventDefault(),e(r.submitter,!0),u.addCard({name:w.value,link:I.value}).then((e=>{G(K(e)),r.target.reset(),o(T,t),V(g)})).catch(console.error).finally((()=>{e(r.submitter,!1)}))})),j.addEventListener("submit",(function(t){t.preventDefault(),e(t.submitter,!0),u.editAvatarInfo(B.value).then((e=>{c.src=e.avatar,V(x)})).catch(console.error).finally((()=>{e(t.submitter,!1)}))})),U.addEventListener("submit",(function(t){e(t.submitter,!0,"Delete","Deleting..."),u.removeCard(i).then((()=>{s.remove(),V(D)})).catch(console.error).finally((()=>{e(t.submitter,!1,"Delete","Deleting...")}))})),y.forEach((e=>{e.addEventListener("mousedown",(e=>{e.target.classList.contains("modal_opened")&&V(e.target)}))})),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{t.addEventListener("submit",(e=>{e.preventDefault()})),function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);a(o,n,t),o.forEach((s=>{s.addEventListener("input",(function(){((e,t,o)=>{t.validity.valid?r(e,t,o):function(e,t,r,o){const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)}(e,t,t.validationMessage,o)})(e,s,t),a(o,n,t)}))}))}(t,e)}))})(t)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bUIzSSxFQUFhQyxFQUFjVCxHQUM5Q29CLEVBQWtCQyxFQUFXTCxFQUFlaEIsRUFDOUMsR0FBRSxHQUVOLENBUUl1SixDQUFrQi9JLEVBQWFSLEVBQVMsR0FDeEMsRUM0TEp3SixDQUFpQnhKLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChcbiAgYnRuLFxuICBpc0xvYWRpbmcsXG4gIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIlxuKSB7XG4gIGlmIChpc0xvYWRpbmcpIGJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICBlbHNlIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xufVxuIiwiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX2J1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmZ1bmN0aW9uIHNob3dJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgc2V0dGluZ3MpIHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmVycm9yQ2xhc3MpO1xufVxuXG5mdW5jdGlvbiBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyA9IHNldHRpbmdzKSB7XG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG59XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCkgPT4ge1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpO1xuICB9KTtcbn07XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncykgPT4ge1xuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKFxuICAgICAgZm9ybUVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsXG4gICAgICBzZXR0aW5nc1xuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpO1xuICB9XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbn07XG5cbmV4cG9ydCBjb25zdCBlbmFibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG59O1xuXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuICB9IGVsc2Uge1xuICAgIGVuYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBzZXR0aW5ncykge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2V0dGluZ3MuaW5wdXRTZWxlY3RvcilcbiAgKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3JcbiAgKTtcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKHNldHRpbmdzKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNldHRpbmdzLmZvcm1TZWxlY3RvcikpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIHNldHRpbmdzKTtcbiAgfSk7XG59O1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IHsgc2V0QnV0dG9uVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICBzZXR0aW5ncyxcbiAgZGlzYWJsZUJ1dHRvbixcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBlbmFibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcblxubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcblxuY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCIxZjNkNDdlYy00OGE2LTQ4ZTAtOTVmMi0wODQ0ZGQ5YTMzYjRcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzLCB1c2VySW5mb10pID0+IHtcbiAgICBjYXJkcy5mb3JFYWNoKGZ1bmN0aW9uIChjYXJkKSB7XG4gICAgICBjb25zdCBjYXJkTm9kZSA9IGNyZWF0ZUNhcmRFbGVtZW50KGNhcmQpO1xuICAgICAgcmVuZGVyQ2FyZChjYXJkTm9kZSk7XG4gICAgfSk7XG4gICAgcHJvZmlsZUF2YXRhci5zcmMgPSB1c2VySW5mby5hdmF0YXI7XG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VySW5mby5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xuICB9KVxuICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZF9fdGVtcGxhdGVcIikuY29udGVudDtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5jb25zdCBwcm9maWxlU2VjdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2NvbHVtblwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lRWxlbWVudCA9XG4gIHByb2ZpbGVTZWN0aW9uRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlSm9iRWxlbWVudCA9IHByb2ZpbGVTZWN0aW9uRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlX19kZXNjcmlwdGlvblwiXG4pO1xuY29uc3QgbW9kYWxzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpKTtcblxuLy9FZGl0IFByb2ZpbGUgRWxlbWVudHNcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IHN1Ym1pdFByb2ZpbGVGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJtb2RhbF9fZm9ybS1lZGl0LXByb2ZpbGVcIl07XG5jb25zdCBuYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjbmFtZVwiKTtcbmNvbnN0IGpvYklucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGVfX2VkaXQtYnRuXCIpO1xuY29uc3QgY2xvc2VFZGl0UHJvZmlsZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI21vZGFsX19lZGl0LXByb2ZpbGUtY2xvc2UtYnRuXCJcbik7XG5jb25zdCBwcm9maWxlU3VibWl0QnRuID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b25cIik7XG5cbi8vQWRkIENhcmQgZWxlbWVudHNcbmNvbnN0IGFkZENhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbW9kYWxcIik7XG5jb25zdCBjbG9zZUFkZENhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsX19hZGQtY2FyZC1jbG9zZS1idG5cIik7XG5jb25zdCBzdWJtaXRBZGRDYXJkRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wibW9kYWxfX2Zvcm0tYWRkLWNhcmRcIl07XG5jb25zdCBzdWJtaXRFZGl0QXZhdGFyRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiZWRpdC1hdmF0YXItZm9ybVwiXTtcbmNvbnN0IGRlbGV0ZUNhcmRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJkZWxldGUtZm9ybVwiXTtcbmNvbnN0IGFkZENhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGVfX2FkZC1jYXJkLWJ0blwiKTtcbmNvbnN0IGF2YXRhck1vZGFsQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnRuXCIpO1xuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IG5ld0NhcmRtYWdlTGlua0lucHV0ID0gYWRkQ2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2UtbGluay1pbnB1dFwiKTtcbmNvbnN0IG5ld0NhcmRDYXB0aW9uSW5wdXQgPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXB0aW9uLWlucHV0XCIpO1xuY29uc3QgY2FyZFN1Ym1pdEJ0biA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b25cIik7XG5jb25zdCBwcm9maWxlQXZhdGFySW5wdXQgPSBzdWJtaXRFZGl0QXZhdGFyRm9ybS5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWF2YXRhci1pbnB1dFwiXG4pO1xuY29uc3QgY2FuY2VsRGVsZXRlQnRuID0gZGVsZXRlQ2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uLWNhbmNlbFwiKTtcbmNvbnN0IG1vZGFsQ2FuY2VsRGVsZXRlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZGVsZXRlLWNsb3NlLWJ0blwiKTtcblxuY29uc3QgcHJldmlld0ltYWdlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsLXByZXZpZXctaW1hZ2VcIik7XG5jb25zdCBwcmV2aWV3SW1hZ2UgPSBwcmV2aWV3SW1hZ2VNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19wcmV2aWV3LWltYWdlXCIpO1xuY29uc3QgcHJldmlld0ltYWdlVGl0bGUgPSBwcmV2aWV3SW1hZ2VNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fcHJldmlldy1pbWFnZS10aXRsZVwiXG4pO1xuY29uc3QgY2xvc2VwcmV2aWV3SW1hZ2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNtb2RhbF9fcHJldmlldy1pbWFnZS1jbG9zZS1idG5cIlxuKTtcbmNvbnN0IGNsb3NlRWRpdEF2YXRhckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI21vZGFsX19lZGl0LWF2YXRhci1jbG9zZS1idG5cIlxuKTtcblxuZnVuY3Rpb24gcmVuZGVyQ2FyZChjYXJkTm9kZSwgbWV0aG9kID0gXCJwcmVwZW5kXCIpIHtcbiAgY2FyZHNMaXN0W21ldGhvZF0oY2FyZE5vZGUpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBpZCkge1xuICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgc2VsZWN0ZWRDYXJkSWQgPSBpZDtcbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZShldnQsIGlkKSB7XG4gIGNvbnN0IGlzQ2FyZExpa2VkID0gZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ1dHRvbi1saWtlZFwiKTtcbiAgYXBpXG4gICAgLnRvZ2dsZUxpa2VDYXJkKGlkLCBpc0NhcmRMaWtlZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbi1saWtlZFwiKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQ2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIikuY2xvbmVOb2RlKHRydWUpO1xuXG4gIGNvbnN0IGNhcmRJbWdFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY2FyZEltZ0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBwcmV2aWV3SW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG5cbiAgICBwcmV2aWV3SW1hZ2VUaXRsZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld0ltYWdlTW9kYWwpO1xuICB9KTtcblxuICBjYXJkSW1nRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWdFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcbiAgY2FyZEltZ0VsZW1lbnQuaWQgPSBkYXRhLl9pZDtcblxuICBjb25zdCBjYXJkVGl0bGVFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBcIi5jYXJkX19jb250ZW50IC5jYXJkX190aXRsZVwiXG4gICk7XG5cbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBpZiAoZGF0YS5pc0xpa2VkKSBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b24tbGlrZWRcIik7XG4gIGNhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiBoYW5kbGVMaWtlKGV2dCwgZGF0YS5faWQpKTtcbiAgY29uc3QgY2FyZERlbGV0ZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcbiAgY2FyZERlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEuX2lkKTtcbiAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9KTtcbiAgY2FyZFRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmNvbnN0IGVzY2FwZU1vZGFsID0gKGV2dCkgPT4ge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIG1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT4ge1xuICAgICAgaWYgKG1vZGFsLmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5lZFwiKSkgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgfSk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBlc2NhcGVNb2RhbCk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZXNjYXBlTW9kYWwpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIHNldEJ1dHRvblRleHQoZXZ0LnN1Ym1pdHRlciwgdHJ1ZSk7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oeyBuYW1lOiBuYW1lSW5wdXQudmFsdWUsIGFib3V0OiBqb2JJbnB1dC52YWx1ZSB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlSm9iRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChldnQuc3VibWl0dGVyLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgc2V0QnV0dG9uVGV4dChldnQuc3VibWl0dGVyLCB0cnVlKTtcbiAgYXBpXG4gICAgLmFkZENhcmQoe1xuICAgICAgbmFtZTogbmV3Q2FyZENhcHRpb25JbnB1dC52YWx1ZSxcbiAgICAgIGxpbms6IG5ld0NhcmRtYWdlTGlua0lucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IGNhcmROb2RlID0gY3JlYXRlQ2FyZEVsZW1lbnQoZGF0YSk7XG4gICAgICByZW5kZXJDYXJkKGNhcmROb2RlKTtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24oY2FyZFN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChhZGRDYXJkTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChldnQuc3VibWl0dGVyLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRBdmF0YXJGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgc2V0QnV0dG9uVGV4dChldnQuc3VibWl0dGVyLCB0cnVlKTtcbiAgYXBpXG4gICAgLmVkaXRBdmF0YXJJbmZvKHByb2ZpbGVBdmF0YXJJbnB1dC52YWx1ZSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZUF2YXRhci5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChldnQuc3VibWl0dGVyLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcbiAgc2V0QnV0dG9uVGV4dChldnQuc3VibWl0dGVyLCB0cnVlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpO1xuICBhcGlcbiAgICAucmVtb3ZlQ2FyZChzZWxlY3RlZENhcmRJZCkgLy8gcGFzcyB0aGUgSUQgdGhlIHRoZSBhcGkgZnVuY3Rpb25cbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoZXZ0LnN1Ym1pdHRlciwgZmFsc2UsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XG4gICAgfSk7XG59XG5cbmVkaXRQcm9maWxlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lRWxlbWVudC50ZXh0Q29udGVudDtcbiAgam9iSW5wdXQudmFsdWUgPSBwcm9maWxlSm9iRWxlbWVudC50ZXh0Q29udGVudC50cmltKCk7XG4gIHJlc2V0VmFsaWRhdGlvbihzdWJtaXRQcm9maWxlRm9ybSwgW25hbWVJbnB1dCwgam9iSW5wdXRdKTtcbiAgZW5hYmxlQnV0dG9uKHByb2ZpbGVTdWJtaXRCdG4sIHNldHRpbmdzKTtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGFkZENhcmRNb2RhbCk7XG59KTtcblxuY2xvc2VFZGl0UHJvZmlsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5jbG9zZUFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChhZGRDYXJkTW9kYWwpO1xufSk7XG5cbmF2YXRhck1vZGFsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcblxuY2xvc2VwcmV2aWV3SW1hZ2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChwcmV2aWV3SW1hZ2VNb2RhbCk7XG59KTtcblxuY2xvc2VFZGl0QXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmNhbmNlbERlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbn0pO1xubW9kYWxDYW5jZWxEZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuLy9BZGQgdGhpcyBldmVudExpc3RlbmVyIHRvIHRoZSBmb3JtIGluc3RlYWQgb2YgdGhlIGJ1dHRvblxuc3VibWl0UHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XG5zdWJtaXRBZGRDYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0KTtcbnN1Ym1pdEVkaXRBdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRWRpdEF2YXRhckZvcm1TdWJtaXQpO1xuZGVsZXRlQ2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVTdWJtaXQpO1xuXG5tb2RhbHMuZm9yRWFjaCgobW9kYWwpID0+IHtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfb3BlbmVkXCIpKSBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xuICB9KTtcbn0pO1xuXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiIsIi8vIHV0aWxzL0FwaS5qc1xuXG5jbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIC8vIGNvbnN0cnVjdG9yIGJvZHlcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIG90aGVyIG1ldGhvZHMgZm9yIHdvcmtpbmcgd2l0aCB0aGUgQVBJXG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlbW92ZUNhcmQoX2lkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7X2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgdG9nZ2xlTGlrZUNhcmQoX2lkLCBpc0xpa2VkKSB7XG4gICAgY29uc3QgbWV0aG9kID0gaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiO1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke19pZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IG1ldGhvZCxcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXRCdXR0b25UZXh0IiwiYnRuIiwiaXNMb2FkaW5nIiwiZGVmYXVsdFRleHQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJsb2FkaW5nVGV4dCIsInRleHRDb250ZW50Iiwic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJlcnJvckVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJkaXNhYmxlQnV0dG9uIiwiYnV0dG9uRWxlbWVudCIsImFkZCIsImRpc2FibGVkIiwiZW5hYmxlQnV0dG9uIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwicHJvZmlsZUF2YXRhciIsImRvY3VtZW50IiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImVkaXRVc2VySW5mbyIsIl9yZWYyIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhZGRDYXJkIiwiX3JlZjMiLCJsaW5rIiwiZWRpdEF2YXRhckluZm8iLCJhdmF0YXIiLCJyZW1vdmVDYXJkIiwiX2lkIiwidG9nZ2xlTGlrZUNhcmQiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzIiwidXNlckluZm8iLCJmb3JFYWNoIiwiY2FyZCIsInJlbmRlckNhcmQiLCJjcmVhdGVDYXJkRWxlbWVudCIsInNyYyIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImNhcmRzTGlzdCIsInByb2ZpbGVTZWN0aW9uRWxlbWVudCIsInByb2ZpbGVOYW1lRWxlbWVudCIsInByb2ZpbGVKb2JFbGVtZW50IiwibW9kYWxzIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImVkaXRQcm9maWxlTW9kYWwiLCJzdWJtaXRQcm9maWxlRm9ybSIsImZvcm1zIiwibmFtZUlucHV0Iiwiam9iSW5wdXQiLCJlZGl0UHJvZmlsZUJ1dHRvbiIsImNsb3NlRWRpdFByb2ZpbGVCdXR0b24iLCJwcm9maWxlU3VibWl0QnRuIiwiYWRkQ2FyZE1vZGFsIiwiY2xvc2VBZGRDYXJkQnV0dG9uIiwic3VibWl0QWRkQ2FyZEZvcm0iLCJzdWJtaXRFZGl0QXZhdGFyRm9ybSIsImRlbGV0ZUNhcmRGb3JtIiwiYWRkQ2FyZEJ1dHRvbiIsImF2YXRhck1vZGFsQnV0dG9uIiwiYXZhdGFyTW9kYWwiLCJkZWxldGVNb2RhbCIsIm5ld0NhcmRtYWdlTGlua0lucHV0IiwibmV3Q2FyZENhcHRpb25JbnB1dCIsImNhcmRTdWJtaXRCdG4iLCJwcm9maWxlQXZhdGFySW5wdXQiLCJjYW5jZWxEZWxldGVCdG4iLCJtb2RhbENhbmNlbERlbGV0ZUJ0biIsInByZXZpZXdJbWFnZU1vZGFsIiwicHJldmlld0ltYWdlIiwicHJldmlld0ltYWdlVGl0bGUiLCJjbG9zZXByZXZpZXdJbWFnZUJ1dHRvbiIsImNsb3NlRWRpdEF2YXRhckJ1dHRvbiIsImNhcmROb2RlIiwiZGF0YSIsImNhcmRFbGVtZW50IiwiY2xvbmVOb2RlIiwiY2FyZEltZ0VsZW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiYWx0Iiwib3Blbk1vZGFsIiwiY2FyZFRpdGxlRWxlbWVudCIsImNhcmRMaWtlQnV0dG9uIiwiZXZ0IiwiaXNDYXJkTGlrZWQiLCJ0YXJnZXQiLCJjb250YWlucyIsInRvZ2dsZSIsImhhbmRsZUxpa2UiLCJoYW5kbGVEZWxldGVDYXJkIiwiZXNjYXBlTW9kYWwiLCJrZXkiLCJtb2RhbCIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwicmVzZXRWYWxpZGF0aW9uIiwidmFsdWUiLCJ0cmltIiwicHJldmVudERlZmF1bHQiLCJzdWJtaXR0ZXIiLCJmaW5hbGx5IiwicmVzZXQiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJlcnJvck1lc3NhZ2UiLCJzaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJlbmFibGVWYWxpZGF0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==